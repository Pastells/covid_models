<<"/home/josep/Projects/covid_models/mathematica/Sird.wl"

data = {{"Day","Infected","Dead","Recovered"},{0,2,0,0},{10,3,0,0},{11,7,0,0},{12,16,0,0},{13,31,0,0},{17,114,0,0},{18,197,1,0},{19,237,3,0},{20,365,5,0},{23,1204,28,23},{24,1639,36,135},{25,2140,48,183},{26,2965,84,189},{27,4231,121,193},{28,5753,136,517},{29,7753,288,517},{30,9191,309,530},{31,11178,491,1028},{32,13716,598,1081},{33,17147,767,1107},{34,19980,1002,1588},{35,24926,1326,2125},{36,28572,1720,2575},{37,33089,2182,3355},{38,39673,2696,3794},{39,47610,3434,5367},{40,56188,4089,7015},{41,64059,4858,9357},{42,72248,5690,12285},{43,78797,6528,14709},{44,85195,7340,16780},{45,94417,8189,19259},{46,102136,9053,22647},{47,110238,10003,26743},{48,117710,10935,30513},{49,124736,11744,34219},{50,130759,12418,38080},{51,135032,13055,40437},{52,140510,13798,43208},{53,146690,14555,48021},{54,152446,15238,52165},{55,157022,15843,55668},{56,161852,16353,59109},{57,166019,16972,62391},{58,169496,17489,64727},{59,172541,18056,67504},{60,177633,18579,70853},{61,182816,19130,74797},{62,188068,19478,72963},{63,191726,20043,74662},{64,195944,20453,77357},{65,200210,20852,80587},{66,204178,21282,82514},{67,208389,21717,85915},{68,213024,22157,89250},{69,219764,22524,92355},{70,223759,22902,95708},{71,207634,23190,98732},{72,209465,23521,100875},{73,210773,23822,102548},{74,212917,24275,108497},{75,213435,24543,112050},{76,215435,24824,114897},{77,216582,25100,117248},{78,217466,25264,118902},{79,218011,25428,121343},{80,219329,25613,123486},{81,220325,25857,126002},{82,221447,26070,128511},{83,222857,26299,131148},{84,223578,26478,133952},{85,224390,26621,136166},{86,227436,26744,137139},{87,228030,26920,138930},{88,228691,27104,140823},{89,229540,27321,143374},{90,230183,27459,144783},{91,230698,27563,146446},{92,231350,27650,149576},{93,231606,27709,150376},{94,232037,27778,150376},{95,232555,27888,150376},{96,233037,27940,150376},{97,234824,28628,150376},{98,235290,28678,150376},{99,235722,28752,150376},{100,235400,26834,150376},{101,236259,27117,150376},{102,236769,27118,150376},{103,237906,27119,150376},{10,238564,27121,150376},{105,239228,27125,150376},{106,239429,27127,150376},{107,239638,27127,150376},{108,239932,27127,150376},{109,240326,27128,150376},{110,240660,27133,150376},{111,240978,27134,150376},{112,241310,27135,150376},{113,241550,27136,150376},{114,241717,27136,150376},{115,241966,27136,150376},{116,242289,27136,150376},{117,242707,27136,150376},{118,243209,27136,150376},{119,243605,27136,150376},{120,243928,27136,150376},{121,244109,27136,150376},{122,244328,27136,150376},{123,244683,27136,150376},{124,245268,27136,150376},{125,245575,28315,150376},{126,245938,28322,150376},{127,246272,28323,150376},{128,246504,28324,150376},{129,246752,28325,150376},{130,247086,28327,150376},{131,247486,28330,150376},{132,247905,28338,150376},{133,248469,28342,150376},{134,248770,28343,150376},{135,248970,28346,150376},{136,249271,28355,150376},{137,249659,28363,150376},{138,250103,28368,150376},{139,250545,28385,150376},{142,251789,28388,150376},{143,252130,28392,150376},{144,252513,28396,150376},{145,253056,2801,150376},{146,253908,28403,150376},{149,255953,28406,150376},{150,256619,28409,150376},{151,257494,28413,150376},{152,258855,28416,150376},{153,260255,28420,150376},{156,264836,28422,150376},{157,266194,28424,150376},{158,267551,28426,150376},{159,270166,28429,150376},{160,272421,28432,150376},{163,278782,28434,150376},{164,280610,28436,150376},{165,282641,28441,150376},{166,285430,28443,150376},{167,288522,28445,150376},{170,297054,28472,150376},{171,302814,28498,150376},{172,305767,28499,150376},{173,309855,28500,150376}};

SpainPop = 45 * 10^6;
datarec = Table[{data[[i,1]],
				 SpainPop - data[[i,1]] - data[[i,2]] - data[[i,3]] - data[[i,4]],
				 data[[i,2]],
				 data[[i,3]],
				 data[[i,4]]},
				{i,2,Dimensions[data][[1]]}];
data = datarec;

initialInfected = 70;
initialRecovered = 0;
initialDeaths = 0;

Print[Sird`Score[70, 30, 40, data, SpainPop, initialInfected, initialRecovered, initialDeaths]];

res = NMinimize[
	{Sird`Score[p1, p2, p3, data, SpainPop, initialInfected, initialRecovered, initialDeaths], p1 > 0, p2 > 0, p3 > 0},
	{p1, p2, p3},
	MaxIterations->500
];
Print[res];
